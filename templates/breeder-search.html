{% extends 'base.html' %}

{% block head %}

    <style>
      #map {
        height: 600px;
        width: 600px;
      }
    </style>

{% endblock %}


{% block content %}

<h4><a href='/breeds/{{ breed.breed_id}}'>{{ breed.name }}</a></h4>
<div>{{ breed.description }}</div>
<img src='{{ breed.photo }}'>

<h4>breeder results near {{ location }}:</h4> 
{% for breeder in breeders %}
<a href='/breeders/{{ breeder.breeder_id }}'>{{ loop.index }} - {{ breeder.name }}</a><br>
{{ breeder.email }}<br>
<span class="address" data-address='{{ breeder.address }}'>{{ breeder.address }}</span><br>
{{ breeder.phone }}<br><br>
{% endfor %}

<div id="map"></div>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script>
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 6,
          center: {lat: 37.5100571, lng: -119.967836}
        });
        var geocoder = new google.maps.Geocoder();

        var addresses = $(".address").map(function () {
            return $(this).data("address")
        });
        console.log(addresses);

        for (var i = 0; i < addresses.length; i++) {
            geocodeAddress(geocoder, map, addresses[i], i);
        }          
      }

      function geocodeAddress(geocoder, resultsMap, address, num) {
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {
            var marker = new google.maps.Marker({
              map: resultsMap,
              position: results[0].geometry.location,
              label: num
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFObsWCCQqa4NCpJrZ4JGUze4rncKmZTw&callback=initMap"
    async defer></script>

{% endblock %}